
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>School Formation - HOME</title>
		
		<link rel="stylesheet" 
			  type="text/css"
			  href="js/toast/jquery.toast.min.css" />
		
		<link rel="stylesheet" 
			  href="js/tablesorter/style.css">
		
		<link rel="stylesheet" 
			  href="dist/css/bootstrap.min.css">
		
		<link rel="stylesheet" 
			  href="datepicker/css/datepicker.css">
			  
		<script type="text/javascript"
				src="js/jquery/jquery-1.10.2.min.js">
		</script>
		<script type="text/javascript" 
				src="js/tablesorter/tsort.min.js">
		</script>
		<script type="text/javascript" 
				src="js/jsonTable.js">
		</script>
		<script type="text/javascript"
				src="js/jquery-ui/ui/jquery-ui.js">
		</script>
		<script type="text/javascript" 
				src="js/toast/jquery.toast.min.js">
		</script>
		
		
		<script type="text/javascript">
				var searchTypeSelection = 1;
				
				/* creates and displays a toast message */
				function createToast(t){
					var options = {
						duration: 5000,
						sticky: false,
						type: t
					};
					
					$.toast('<h4>Success</h4> You are register to this session. ', options);
				}
				
				function populateLocationList(select, data) {
				    var items = [];
				    $.each(data, function (id, option) {
				        items.push('<li role="presentation"> <a role="menuitem" tabindex="-1" href="#">' + option.city + '</a></li>');
				    });  
				    select.html(items.join(''));
				}
							
				function susbcribe(course_session_id) {
				    alert('susbcribe to course_session_id:' + course_session_id+ ' TODO !');
				}
				

				/* update table data from url */
				function updateTable(jsonData)
				{
					 $("#dataTable").jsonTable({
						head : ['Code','Title','Start','End', 'Location', 'Subscribe'],
						json : ['courseCode','title', 'start', 'end', 'location', 'Subscribe']
					});
					
					
					jQuery.each(jsonData, function(i, val) {
						val['Subscribe']="<button type=\"button\" class=\"btn btn-default btn-lg\" onclick=\"susbcribe("+val['id'] + ")\"><span class=\"glyphicon glyphicon-plus-sign\"></span></button>";
					});
					
				
					var options = {
						source : jsonData,
						rowClass : "rowClass",
					}
					document.getElementById("dataTable").style.height = "10px";
					$("#dataTable").jsonTableUpdate(options);
					
					/* initiate table with new columns get from JSON */
					$('table.tableSorter').tableSort();
					
					/* 	register event to display toast on click on new 
						add button (got from JSON) */
					$('.success').click(function(){
						createToast($(this).attr('class'));
						return false;
					});
				}
			
				
				function setSearch(id) {
					searchTypeSelection = id;
					switch(searchTypeSelection) {
					case 0:
						document.getElementById('titleForm').style.display = 'none';
						document.getElementById('locationSaver').style.display = 'none';
						document.getElementById('launchScript').style.display = 'none';
						document.getElementById('datepicker').style.display = 'inline';
						break;
					case 1:
						document.getElementById('titleForm').style.display = 'none';
						document.getElementById('locationSaver').style.display = 'inline';
						document.getElementById('launchScript').style.display = 'none';
						document.getElementById('datepicker').style.display = 'none';
						break;
					case 2:
						document.getElementById('titleForm').style.display = 'inline';
						document.getElementById('locationSaver').style.display = 'none';
						document.getElementById('launchScript').style.display = 'inline';
						document.getElementById('datepicker').style.display = 'none';
						break;
					}
				}
				
				function getJsonUpdateTable() {
					if (searchTypeSelection == 2) {
						$.getJSON("http://localhost:8080/RED/service/byKeyword/" + document.getElementById('titleForm').value, function(data) {
							
							updateTable(data);
							});
					}
				}
				
				
				/* autoclose datepicker when date changed */
				$(function() {
					$('#datepicker').datepicker().on('changeDate', function (ev) {
						if(ev.viewMode === 'days'){
							$(this).datepicker('hide');
							$.getJSON("http://localhost:8080/RED/service/byDate/" + $('#datepicker').val(), function(data) { 
								updateTable(data);
							});
						}
						
					});
				});
				
				
				$(document).ready(function() {
					/* update table data */
					//updateTable();
					
					/* initiate toasts parameters */
					$.toast.config.align = 'right';
					$.toast.config.width = 400;
					
					$.getJSON("http://localhost:8080/RED/service/byLocation", function(json) {
						populateLocationList($('#locationValues'), json);
						$("#locationValues li a").click(function() {
							$("#locationSaver").val($(this).text());
							$.getJSON("http://localhost:8080/RED/service/byLocation/" + $(this).text(), function(data) { 
								updateTable(data)
								});
							});
					});
					setSearch(searchTypeSelection);
				});
				
		</script>
		
		
		<script type="text/javascript" src="datepicker/js/bootstrap-datepicker.js"></script>

	</head>
	
	<body>   
  
		<div class="container" style="width:1000px">
		
		
			<br/>
			<div class="btn-group btn-group-justified" data-toggle="buttons">
				  <label class="btn btn-default" onclick="setSearch(0);">
				    <input type="radio" name="date" id="date"><span class="glyphicon glyphicon-calendar">Date</span>
				  </label>
				  <label class="btn btn-default active" onclick="setSearch(1);">
				    <input type="radio" name="location" id="location"><span class="glyphicon glyphicon-pushpin">Location</span>
				  </label>
				  <label class="btn btn-default" onclick="setSearch(2);">
				    <input type="radio" name="title" id="title"><span class="glyphicon glyphicon-text-height">itle</span>
				  </label>
			</div>
			
			<br/>
			<div class="row">
        		<div class="col-md-4">
					<input type="text" id="datepicker" class="form-control" placeholder="Date" data-date-format="dd-mm-yyyy">
				</div>
				
        		<div class="col-md-4">
					<div class="dropdown">
			  			<input type="text" id="locationSaver" class="form-control" placeholder="Location" role="button" data-toggle="dropdown" data-target="#" checked>
			  			<ul id="locationValues" class="dropdown-menu" role="menu" aria-labelledby="dLabel"></ul>
					</div>	  			
       			</div>
        		<div class="col-md-2" >
        			<input type="text" id="titleForm" class="form-control" placeholder="Title">
        		</div>
        		<div class="col-md-2">
					<button type="button" class="btn btn-primary" id="launchScript" onclick="getJsonUpdateTable();">Update</button>
				</div>
      		</div>
			

			<br/><br/>
			
			
				
			<br />
			
			<div id="panelData" class="panel panel-primary">
				<div class="panel-heading">Course Sessions</div>
 
				<table id="dataTable"
					class="table table-hover table-striped tableSorter">
					<thead>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
			
						
		</div>
			
			<script src="dist/js/bootstrap.min.js"></script>
			
			<script type="text/javascript">$('.datepicker').datepicker({todayHighlight:"true"})</script>
			


			
	</body>
</html>
